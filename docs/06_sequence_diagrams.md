## Сценарий 1: Первичная инициализация БД (Happy Path)

Пользователь (Супервайзер) запускает приложение в первый раз и вводит данные своей PostgreSQL.

| Участник              | Роль                            |
| --------------------- | ------------------------------- |
| Супервайзер (Юзер)    | Пользователь в браузере         |
| SetupPage (фронт)     | React-компонент формы настройки |
| SetupController (API) | Точка входа на бэкенде          |
| DbInitializerService  | Логика проверки и миграции      |
| PostgreSQL            | Сервер Базы Данных              |

**Поток выполнения:**

1.  **User** вводит данные (Host, Port, User, Password, DbName) и нажимает "Подключить".
2.  **SetupPage** формирует объект `InitDatabaseDto` и отправляет **POST** запрос на `/api/setup/init`.
3.  **SetupController** принимает запрос и вызывает метод сервиса `_dbInitializer.InitializeAsync(dto)`.
4.  **DbInitializerService** выполняет следующие действия:
    *   Формирует строку подключения (`ConnectionString`).
    *   Создает временный контекст `AppDbContext`.
    *   Пытается открыть соединение с **PostgreSQL** (`context.Database.CanConnect()`).
    *   *Если ошибка:* выбрасывает исключение, контроллер возвращает **400 Bad Request** с текстом ошибки.
    *   *Если успешно:* Вызывает `context.Database.Migrate()`. **PostgreSQL** создает таблицы согласно моделям.
5.  **DbInitializerService** сохраняет строку подключения в файл конфигурации (например, `db_config.json` или обновляет `appsettings.json`).
6.  **SetupController** возвращает код **200 OK** и сообщение "Database initialized".
7.  **SetupPage** получает успешный ответ и автоматически редиректит пользователя на страницу `/login`.

---
## Сценарий 2: Загрузка Канбан-доски

Авторизованный сотрудник заходит на главную страницу "Задачи". Система загружает список задач.

| Участник             | Роль                       |
| -------------------- | -------------------------- |
| Рабочий              | Пользователь в браузере    |
| KanbanBoard (Фронт)  | React-компонент доски      |
| TaskController (API) | Точка входа на бэкенде     |
| TaskService          | Логика проверки и миграции |
| AppDbContext         | ORM                        |

**Поток выполнения:**

1.  KanbanBoard при монтировании (useEffect) отправляет *GET* запрос на `/api/tasks`.
2.  Middleware (ASP.NET Core) перехватывает запрос, проверяет JWT-токен в заголовке.
    *   Если токен невалиден: возвращает *401 Unauthorized*.
3.  TasksController вызывает метод `_taskService.GetAllTasksAsync()`.
4.  TaskService обращается к *AppDbContext*:
    *   Запрашивает таблицу `Tasks`.
    *   Делает `.Include(t => t.Assignee)`, чтобы подтянуть данные об исполнителе (аватар, имя).
5.  AppDbContext генерирует SQL `SELECT ... JOIN Employees ...` и возвращает список сущностей `TaskItem`.
6.  TaskService преобразует (мапит) сущности `TaskItem` в список DTO `TaskResponseDto` (скрывая лишние поля БД).
7.  TasksController возвращает JSON массив клиенту (*200 OK*).
8.  KanbanBoard обновляет стейт и отрисовывает колонки с карточками.

---

## Сценарий 3: Перемещение задачи (Drag-n-Drop)

Пользователь перетаскивает карточку задачи из колонки "TODO" в колонку "PROGRESS".

| Участник             | Роль                    |
| -------------------- | ----------------------- |
| Рабочий              | Пользователь в браузере |
| KanbanBoard (Фронт)  | React-компонент доски   |
| TaskController (API) | Точка входа на бэкенде  |
| TaskService          | Логика обновления       |

**Поток выполнения:**

1.  User бросает карточку в новую колонку.
2.  KanbanBoard обновляет UI (карточка перемещается визуально мгновенно).
3.  KanbanBoard отправляет PATCH запрос на `/api/tasks/{id}/status` с телом `{ "newStatus": "Progress" }`.
4.  TasksController вызывает `_taskService.UpdateStatusAsync(id, status)`.
5.  TaskService ищет задачу в БД по ID.
    *   Если не найдена: выбрасывает исключение -> API возвращает 404 Not Found.
6.  TaskService изменяет поле `Status` у сущности.
7.  TaskService вызывает `await _context.SaveChangesAsync()`. БД обновляет запись.
8.  TasksController возвращает 200 OK (или обновленный DTO задачи).
9.  Обработка ошибок на клиенте: Если API вернул ошибку (например, сеть упала), KanbanBoard откатывает изменения и возвращает карточку назад, показывая уведомление об ошибке.