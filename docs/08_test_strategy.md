# 1 - Пирамида тестирования

Для обеспечения качества Splitflow используется трехуровневая стратегия тестирования.

## Уровень 1: Unit Tests (Модульные) - 70% покрытия

Тестирование отдельных функций и классов в изоляции.

- **Backend (.NET / xUnit):**
    - *Цель:* Проверка бизнес-логики и валидации.
    - *Инструменты:* `xUnit`, `Moq` (для имитации DbContext).
    - *Что тестируем:*
        - Валидацию `CreateTaskDto` (нельзя создать задачу без заголовка).
        - Логику смены статуса (State Machine, если есть сложные правила).
        - Парсинг строки подключения в `SetupService`.

- **Frontend (React / Vitest):**
    - *Цель:* Проверка рендеринга компонентов и утилитарных функций.
    - *Инструменты:* `Vitest`, `React Testing Library`.
    - *Что тестируем:*
        - Компонент `TaskCard`: отображает ли верный цвет приоритета?
        - Функцию фильтрации списка задач.

## Уровень 2: Integration Tests (Интеграционные) - 20%

Тестирование взаимодействия API и Базы Данных.

- **Backend:**
    - *Инструменты:* `Microsoft.AspNetCore.Mvc.Testing` (`WebApplicationFactory`), `Testcontainers` (Docker PostgreSQL).
    - *Сценарий:* Поднять тестовую БД в контейнере -> Накатить миграции -> Выполнить HTTP запрос к контроллеру -> Проверить запись в БД.
    - *Кейс:* `SetupController` — проверка, что при отправке валидных данных создаются таблицы в пустой БД.

## Уровень 3: E2E Tests (Сквозные) - 10%

Эмуляция действий реального пользователя в браузере.

- **Инструменты:** Playwright или Cypress.
- **Окружение:** Staging сервер с чистой БД.
- **Сценарии:** См. раздел 3.

# 2 - Матрица покрытия требований (Traceability Matrix)

Связь обязательных требований (MUST) с тестами.

| ID     | Требование (Req)       | Тип теста        | Описание проверки                                                   |
| :----- | :--------------------- | :--------------- | :------------------------------------------------------------------ |
| **REQ-1**  | Аутентификация         | Integration      | POST `/auth/login` с верными и неверными данными. Проверка JWT.       |
| **REQ-2**  | Просмотр доски         | Unit (Front)     | Рендер компонента `<KanbanBoard />` с мок-данными (3 колонки).        |
| **REQ-3**  | Создание задачи        | E2E              | Клик "+", заполнение формы, Submit, проверка появления карточки.    |
| **REQ-4**  | Смена статуса          | Integration      | PATCH `/tasks/{id}/status`. Проверка изменения поля в БД.             |
| **REQ-5**  | Поиск сотрудников      | Unit (Back)      | Вызов сервиса `Search("Ivan")`. Проверка SQL-фильтра `Likе`.            |
| **REQ-6**  | Дэшборд                | Unit (Back)      | Проверка математики подсчета задач (Count).                         |

# 3 - План E2E тестирования (Smoke Test)

Этот тест запускается перед каждым релизом (deploy).

**Сценарий "Жизненный цикл задачи":**

1. **Login:** Открыть страницу `/login`. Ввести `admin@splitflow.anc` / `password`. Нажать "Войти".
    - Check: Редирект на `/dashboard`.
2. **Navigation:** Кликнуть в меню "Задачи".
    - Check: Отображение 3 колонок.
3. **Create:** Нажать "+". Ввести Title="E2E Test Task". Выбрать Priority="High". Save.
    - Check: Модалка закрылась. В колонке `TODO` появилась новая карточка.
4. **Move:** Перетащить карточку из `TODO` в `PROGRESS`.
    - Check: Карточка осталась в новой колонке. Цвет индикатора сменился.
5. **Setup Check (Special):** (Отдельный тест)
    - Запустить приложение с пустым конфигом.
    - Check: Редирект на `/setup`.

# 4 - Критерии готовности к разработке (Definition of Ready)

Проектирование считается завершенным, так как:

    - [x] **Архитектура:** Определена (Client-Server, .NET + React).

    - [x] **Данные:** Схема БД и DTO зафиксированы.

    - [x] **UI:** Макеты всех экранов готовы.

    - [x] **API:** Контракты (endpoints) описаны.

    - [x] **QA:** Стратегия тестирования утверждена.

Можно приступать к реализации.